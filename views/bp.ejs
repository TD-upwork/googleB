<!DOCTYPE html>
<html>
    <head>
        <title>Server Sent Events</title>
        <script src='https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js'></script>
        <script src='https://cdn.plot.ly/plotly-latest.min.js'></script>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
        <link rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.css">
        <!--  DATATABLE -->
        <script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
        <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
        <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>

        <!------ Include the above in your HEAD tag ---------->
        
        <script language="JavaScript" src="https://code.jquery.com/jquery-1.12.4.js" type="text/javascript"></script>
        <script language="JavaScript" src="https://cdn.datatables.net/1.10.13/js/jquery.dataTables.min.js" type="text/javascript"></script>
        <script language="JavaScript" src="https://cdn.datatables.net/1.10.13/js/dataTables.bootstrap.min.js" type="text/javascript"></script>
        <script language="JavaScript" src="https://cdn.datatables.net/responsive/2.1.1/js/dataTables.responsive.min.js" type="text/javascript"></script>
        <script language="JavaScript" src="https://cdn.datatables.net/responsive/2.1.1/js/responsive.bootstrap.min.js" type="text/javascript"></script>
        
        <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" />
        <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.13/css/dataTables.bootstrap.min.css" />
        <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/responsive/2.1.1/css/responsive.bootstrap.min.css" />


      <!----> 
    <style>
        .loader,
        .loader:after {
            border-radius: 50%;
            width: 10em;
            height: 10em;
        }
        .loader {            
            margin: 60px auto;
            font-size: 10px;
            position: relative;
            text-indent: -9999em;
            border-top: 1.1em solid rgba(255, 255, 255, 0.2);
            border-right: 1.1em solid rgba(255, 255, 255, 0.2);
            border-bottom: 1.1em solid rgba(255, 255, 255, 0.2);
            border-left: 1.1em solid #ffffff;
            -webkit-transform: translateZ(0);
            -ms-transform: translateZ(0);
            transform: translateZ(0);
            -webkit-animation: load8 1.1s infinite linear;
            animation: load8 1.1s infinite linear;
        }
        @-webkit-keyframes load8 {
            0% {
                -webkit-transform: rotate(0deg);
                transform: rotate(0deg);
            }
            100% {
                -webkit-transform: rotate(360deg);
                transform: rotate(360deg);
            }
        }
        @keyframes load8 {
            0% {
                -webkit-transform: rotate(0deg);
                transform: rotate(0deg);
            }
            100% {
                -webkit-transform: rotate(360deg);
                transform: rotate(360deg);
            }
        }
        #loadingDiv {
            position:absolute;;
            top:0;
            left:0;
            width:100%;
            height:100%;
            background-color:#000;
        }
    </style>
    </head>
    <body>
       <div class="container-fluid">
           <div id="updates"></div>
           <br>
           <div class="row">
               <div class="col-lg-4 col-md-4 col-sm-12">
                  <div class="active-title text-center"><h5>In Last 30 Minutes</h5></div>
                  <div class="active-number text-center"><h1 id="activeFiveMin"></h1></div>
                  <div class="active-desc text-center"><h6>active users on site</h6></div>
                  <br>
                  <!-- <div class="active-title text-center"><p>Device stats (Users in the last 30 minutes)</p></div> -->
                  <canvas id="myChart"></canvas>
               </div>
               <div id='histogram' class="col-lg-8 col-md-8 col-sm-12">
               </div>
           </div>
           <br>
           <!--
            <div class="row">
               <div class="col-12">
                  <table class="table table-striped table-hover">
                     <thead>
                   <tr>
                     <th scope="col">#</th>
                     <th scope="col">Active Page</th>
                     <th scope="col">Page Title</th>
                     <th scope="col">Active Users</th>
                   </tr>
                 </thead>
                 <tbody>
                   <tr>
                     <th scope="row">1</th>
                     <td>/hongkong/article/1295541-驗DNA發現「細仔非親生」揭妻出軌友人 2孩爸咁樣報復竟暖心收場</td>
                     <td>驗DNA發現「細仔非親生」揭妻出軌友人 2孩爸咁樣報復竟暖心收場</td>
                     <td>351</td>
                   </tr>
                   <tr>
                     <th scope="row">2</th>
                     <td>/hongkong/article/1295541-驗DNA發現「細仔非親生」揭妻出軌友人 2孩爸咁樣報復竟暖心收場</td>
                     <td>驗DNA發現「細仔非親生」揭妻出軌友人 2孩爸咁樣報復竟暖心收場</td>
                     <td>351</td>
                   </tr>
                   <tr>
                     <th scope="row">3</th>
                     <td>/hongkong/article/1295541-驗DNA發現「細仔非親生」揭妻出軌友人 2孩爸咁樣報復竟暖心收場</td>
                     <td>驗DNA發現「細仔非親生」揭妻出軌友人 2孩爸咁樣報復竟暖心收場</td>
                     <td>351</td>
                   </tr>
                 </tbody>
               
                 </table>
               </div>
            </div>
         -->
           <div class="row">
              <div class="col-12">

                 <!-- <button class="btn btn-primary" onclick="openTab(event, 'activeUsers')">Active Users (Last 30 min)</button> -->
                 <button class="btn btn-primary" onclick="openTab(event, 'pageViews')">Page Views (Last 30 min)</button>

              </div>

             <!-- <div id="activeUsers2" class="tabcontent" style="display:none"> -->
             <!--    <div class="col-12"> -->

             <!--       <table border=1  id="datatable1" class="table table-striped table-hover"> -->
             <!--         <tbody id="table5"> -->
             <!--         <tr> -->
             <!--           <td>Page Title</td> -->
             <!--           <td>Active Users (Last minute)</td> -->
             <!--         </tr> -->
             <!--         </tbody> -->
             <!--       </table> -->


             <!--    </div> -->
             <!-- </div> -->
<!-- DATATABLE START -->
             <div class="row">
           </div>
   
           <div class="row">

             <!-- <div id="activeUsers" class="tabcontent" style="display:block"> -->

             <!--   <h2 class="text-center">Responsive Datatable</h2> -->

             <!--   <div class="col-md-12"> -->
   
             <!--       <table id="example" class="table table-striped table-bordered dt-responsive nowrap" cellspacing="0" width="100%"> -->
             <!--           <thead> -->
             <!--               <tr> -->
             <!--                   <th>PAGE</th> -->
             <!--                   <th>PAGE URL</th> -->
             <!--                   <th>PAGE TITLE</th> -->
             <!--                   <th>ACTIVE USERS</th> -->
             <!--               </tr> -->
             <!--           </thead> -->


   
             <!--       </table> -->
   
             <!--   </div> -->
             <!-- </div> -->

             <div id="pageViews" class="tabcontent" style="display:block">

               <h2 class="text-center">Responsive Datatable</h2>

               <div class="col-md-12">

                   <table id="example2" class="table table-striped table-bordered dt-responsive nowrap" cellspacing="0" width="100%">
                       <thead>
                           <tr>
                               <th>PAGE</th>
                               <th>PAGE URL</th>
                               <th>PAGE TITLE</th>
                               <th>PAGE VIEWS</th>
                           </tr>
                       </thead>


   
                   </table>


               </div>
             </div>

           </div>
<!-- DATATABLE END-->
             <div id="pageViews2" class="tabcontent" style="display:none">
                <div class="col-12">

                   <table border=1 id="datatable2" class="table table-striped table-hover">
                     <tbody id="table6">
                     <tr>
                       <td>Page Title</td>
                       <td>Page Views (Last 30 min)</td>
                     </tr>
                     </tbody>
                   </table>
                </div>
             </div>

          </div>


       </div>
       <!-- <script src="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.js"></script> 
       <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
      -->
       <!-- bootstrap5 dataTables js cdn -->
      
      <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
      <script src="https://cdn.datatables.net/1.11.3/js/dataTables.bootstrap5.min.js"></script>
      <script src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.min.js"></script>
      
    </body>
    <script type="text/javascript">    

        var source = new EventSource('/bp')

        source.addEventListener('message', function(e) {  
            var jsonData = JSON.parse(e.data);          
            
            var usersThirtyMinutes = jsonData.thirtyMinutesAgo;

            document.getElementById('activeFiveMin').innerHTML = usersThirtyMinutes;

            //document.getElementById('a').innerHTML += "<td>"+jsonData.array1+"</td>"

           var xArray = [];

           for (var i = 0; i < 30; i++) {
              xArray.push(i + 1);
           }
            var yArray = [];
            
           for (var i = 0; i < 30; i++) {
              yArray.push(jsonData.array1[i]);
           }


            var data = [{
              x:xArray,
              y:yArray,
              type:"bar"
            }];

            var layout = {autosize: false, width: 750, height: 300, title:"Active Users per minute (y-axis is active users, x-axis is minutes ago)"};

            Plotly.newPlot("histogram", data, layout);

            var initialUsers;
            var initialViews;
            var temp = '';
            var duplicate;
            var count = 1;
            var DataTable = [];
            var DataTable2 = [];

                                                                                                                                                            $('#example2').dataTable().fnDestroy();

              for (var i = 0; i < jsonData.length; i++) {


                  var item2 = {
                     "page": count.toString(),
                     "page_url": jsonData.url[i],
                     "page_title": jsonData.title[i],
                     "page_views": jsonData.views[i]
                  };
                  DataTable2.push(item2);



                 count++


              }


              $('#example2').DataTable({
                     "processing": true,
                     "info": true,
                     "stateSave": true,
                     data: DataTable2,
                     "columns": [
                        { "data": "page" },
                        { "data": "page_url" },
                        { "data": "page_title" },
                        { "data": "page_views" }
                     ]
               });



            


         }, false)


    </script>

    <script>
       function openTab(evt, tabName) {
           // Declare all variables
           var i, tabcontent, tablinks;

           // Get all elements with class="tabcontent" and hide them
           tabcontent = document.getElementsByClassName("tabcontent");
           for (i = 0; i < tabcontent.length; i++) {
               tabcontent[i].style.display = "none";
           }

           // Get all elements with class="tablinks" and remove the class "active"
           tablinks = document.getElementsByClassName("btn btn-primary");
           for (i = 0; i < tablinks.length; i++) {
               tablinks[i].className = tablinks[i].className.replace(" active", "");
           }

           // Show the current tab, and add an "active" class to the button that opened the tab
           document.getElementById(tabName).style.display = "block";
           evt.currentTarget.className += " active";
       }
   </script>
   <script>
      $('body').append('<div style="" id="loadingDiv"><div class="loader">Loading...</div></div>');
      $(window).on('load', function(){
        setTimeout(removeLoader, 20000); //wait for page load PLUS two seconds.
      });
      function removeLoader(){
          $( "#loadingDiv" ).fadeOut(500, function() {
            // fadeOut complete. Remove the loading div
            $( "#loadingDiv" ).remove(); //makes page more lightweight
        });
      }
   </script>
<!--
       <script>
var data = {
   "page": (i + 1).toString(),
   "page_url": "",
   "page_title": jsonData.pageTitles[i],
   "active_user": jsonData.user[i]
};
data.push(data);
var data = [
          {   
              "page":"1",
              "page_url": "/hongkong/article/1295541-驗DNA發現「細仔非親生」揭妻出軌友人 2孩爸咁樣報復竟暖心收場",
              "page_title": "驗DNA發現「細仔非親生」揭妻出軌友人 2孩爸咁樣報復竟暖心收場",
              "active_user": "15",
          },
          {
              "page":"2",
              "page_url": "/hongkong/article/1295541-驗DNA發現「細仔非親生」揭妻出軌友人 2孩爸咁樣報復竟暖心收場",
              "page_title": "驗DNA發現「細仔非親生」揭妻出軌友人 2孩爸咁樣報復竟暖心收場",
              "active_user": "15",
          },
          {
             "page":"3",
              "page_url": "/hongkong/article/1295541-驗DNA發現「細仔非親生」揭妻出軌友人 2孩爸咁樣報復竟暖心收場",
              "page_title": "驗DNA發現「細仔非親生」揭妻出軌友人 2孩爸咁樣報復竟暖心收場",
              "active_user": "15",
          },
          {
              "page":"4",
              "page_url": "/hongkong/article/1295541-驗DNA發現「細仔非親生」揭妻出軌友人 2孩爸咁樣報復竟暖心收場",
              "page_title": "驗DNA發現「細仔非親生」揭妻出軌友人 2孩爸咁樣報復竟暖心收場",
              "active_user": "15",
          }
         ]
      $(document).ready(function () {
        $('#example').DataTable({
            "processing": true,
            "info": true,
            "stateSave": true,
            data: data,
            "columns": [
                { "data": "page" },
                { "data": "page_url" },
                { "data": "page_title" },
                { "data": "active_user" }
            ]
        });
    });
    
       </script>
      -->
</html>

